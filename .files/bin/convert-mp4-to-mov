#!/bin/bash

set -x
set -u

if [ $# -ne 2 ] ; then
    echo "no arguments"
    exit 0
fi

INPUT_PATH="${1}"
if [ ! -f "${INPUT_PATH}" ] ; then
    echo "input file does not exist: ${INPUT_PATH}"
    exit 0
fi

OUTPUT_PATH="${2}"
if [ -f "${OUTPUT_PATH}" ] ; then
    echo "output file already existing: ${OUTPUT_PATH}"
    exit 0
fi

echo "INPUT_PATH: ${INPUT_PATH}"
echo "OUTPUT_PATH: ${OUTPUT_PATH}"

ffmpeg \
   -hide_banner \
   -i "${INPUT_PATH}" \
   -c:v libx264 \
   -preset slow \
   -profile:v high \
   -crf 18 \
   -coder 1 \
   -pix_fmt yuv420p \
   -movflags +faststart \
   -g 30 \
   -bf 2 \
   -c:a aac \
   -b:a 384k \
   -profile:a aac_low \
   -f mov \
   "${OUTPUT_PATH}"


# -vcodec copy \
# -acodec copy \
# -loglevel warning \
# -vcodec h264 \

exit 0
